{% extends 'administrador/inicio_administrador.html' %}
{% load static %}
{% block css %}
{{ block.super }}
<link rel="stylesheet" href="{% static 'css/style_administrador/inicio_preguntas.css' %}">
{% endblock %}
{% block content %}
<div class="audiobooks-wrapper">
    <h2 class="title">Mis audiolibros</h2>
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Buscar por titulo del libro">
    </div>
    {% if audiolibros %}
    <div class="audiobook-grid">
        {% for audiobook in audiolibros %}
        <div class="audiobook-card">

            {% if audiobook.cover_image %}
            <img src="{{ audiobook.cover_image.url }}" alt="{{ audiobook.title }}">
            {% endif %}

            <h3>{{ audiobook.title }}</h3>
            <p class="author">{{ audiobook.author_name }}</p>

            {% if request.user == audiobook.added_by %}
            <a href="{% url 'manage_vocabulary' audiobook.id %}" class="btn-questions">
                Crear glosario
            </a>
            {% else %}
            <button class="btn-questions disabled" disabled>
                Sin acceso
            </button>
            {% endif %}

        </div>
        {% endfor %}
    </div>
    {% else %}
    <p class="empty">
        Aún no has creado audiolibros.
    </p>
    {% endif %}
</div>


<script>
    document.addEventListener("DOMContentLoaded", () => {

        const input = document.getElementById("searchInput");
        const cards = document.querySelectorAll(".audiobook-card");

        // Si no estamos en esta página, no hace nada
        if (!input || cards.length === 0) return;

        const normalize = text =>
            text.normalize("NFD").replace(/[\u0300-\u036f]/g, "").toLowerCase();

        input.addEventListener("keyup", () => {
            const value = normalize(input.value.trim());

            cards.forEach(card => {
                const titleEl = card.querySelector("h3");
                const title = titleEl ? normalize(titleEl.textContent) : "";

                card.style.display = title.includes(value) ? "" : "none";
            });
        });

    });
</script>
{% endblock %}